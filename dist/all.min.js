angular.module("sample",["ngRoute","ngCkeditor","ui.bootstrap","ml.common","ml.search","ml.search.tpls","ml.utils","sample.user","sample.search","sample.common","sample.detail","sample.create","sample.esriMap","sample.sql","sample.data","sample.sources"]).config(["$routeProvider","$locationProvider","mlMapsProvider",function(e,t,r){"use strict";t.html5Mode(!0),e.when("/",{templateUrl:"/sources/sources.html",controller:"SourcesCtrl",controllerAs:"sourcesCtrl",resolve:{counts:function(e){return e.get("/v1/resources/datasources").then(function(e){return e.data})}}}).when("/search",{templateUrl:"/search/search.html",controller:"SearchCtrl",reloadOnSearch:!1}).when("/create",{templateUrl:"/create/create.html",controller:"CreateCtrl"}).when("/detail",{templateUrl:"/detail/detail.html",controller:"DetailCtrl"}).when("/profile",{templateUrl:"/user/profile.html",controller:"ProfileCtrl"}).when("/sql-explorer",{templateUrl:"/sql/sql-explorer.html",controller:"SqlCtrl"}).when("/sql-editor",{templateUrl:"/sql/sql-editor.html",controller:"SqlCtrl"}).when("/data",{templateUrl:"/data/data.html",controller:"DataCtrl"}).otherwise({redirectTo:"/"})}]),function(){"use strict";function e(){return{restrict:"E",replace:!0,template:'<div class="chart"></div>',scope:{data:"=",labels:"="},controller:"@",controllerAs:"ctrl",name:"controllerName",link:function(e,t,r){var a=Math.max(window.innerHeight-225,400);e.createChart=function(n){t.css("height",r.height||a);var l=angular.extend(n,{});l.chart||(l.chart={}),l.chart.renderTo=t[0],t.css("height",r.height||"400px"),e.chart=new Highcharts.Chart(l)},e.compareDates=function(e,t){if(e.x&&t.x){if(e.x<t.x)return-1;if(e.x>t.x)return 1}else{if(e[0]<t[0])return-1;if(e[0]>t[0])return 1}return 0}}}}angular.module("sample.common",[]).directive("chart",e)}(),angular.module("sample.common",[]).filter("object2Array",function(){"use strict";return function(e){var t=[];for(var r in e)e[r].__key=r,t.push(e[r]);return t}}),function(){"use strict";angular.module("sample.data",[]).service("DataService",function(e){this.loadMedData=function(){var t="";return e.post("/v1/resources/load-feeds",t)},this.loadClaims=function(){var t="";return e.post("/v1/resources/load-claims",t)},this.loadMemberData=function(){var t="";return e.post("/v1/resources/load-members",t)}}).controller("DataCtrl",["$scope","$routeParams","DataService",function(e,t,r){var a={results:null,medNews:{status:null,loadRunning:!1,loadSucceeded:!1,loadFailed:!1},claims:{status:null,loadRunning:!1,loadSucceeded:!1,loadFailed:!1},memberData:{status:null,loadRunning:!1,loadSucceeded:!1,loadFailed:!1}};angular.extend(e,{model:a,loadMedicalNews:function(){a.medNews.loadSucceeded=!1,a.medNews.loadFailed=!1,a.medNews.loadRunning=!0,a.medNews.status="Loading Medical News",a.results=r.loadMedData().success(function(e,t,r,n){a.medNews.loadSucceeded=!0,a.medNews.loadRunning=!1,a.medNews.status="Medical News Loaded"}).error(function(e,t,r,n){console.log("Medical News Load - error: "+e),a.medNews.loadFailed=!0,a.medNews.loadRunning=!1,a.medNews.status="Medical News Load Failed: "+e})},loadClaims:function(){a.claims.loadSucceeded=!1,a.claims.loadFailed=!1,a.claims.loadRunning=!0,a.claims.status="Loading Claims",a.results=r.loadClaims().success(function(e,t,r,n){console.log(e),a.claims.loadSucceeded=!0,a.claims.loadRunning=!1,a.claims.status="Claims Loaded"}).error(function(e,t,r,n){console.log("Claims Load - error: "+e),a.claims.loadFailed=!0,a.claims.loadRunning=!1,a.claims.status="Claims Load Failed: "+e})},loadMemberData:function(){a.memberData.loadSucceeded=!1,a.memberData.loadFailed=!1,a.memberData.loadRunning=!0,a.memberData.status="Loading Member Data",a.results=r.loadMemberData().success(function(e,t,r,n){console.log(e),a.memberData.loadSucceeded=!0,a.memberData.loadRunning=!1,a.memberData.status="Member Data Loaded"}).error(function(e,t,r,n){console.log("Member Data Load - error: "+e),a.memberData.loadFailed=!0,a.memberData.loadRunning=!1,a.memberData.status="Member Data Load Failed: "+e})}})}])}(),angular.module("sample.create").directive("compile",function(e){"use strict";return function(t,r,a){t.$watch(function(e){return e.$eval(a.compile)},function(a){r.html(a),e(r.contents())(t)})}}),function(){"use strict";angular.module("sample.create").controller("CreateCtrl",["$scope","MLRest","$window","User",function(e,t,r,a){var n={person:{isActive:!0,balance:0,picture:"http://placehold.it/32x32",age:0,eyeColor:"",name:"",gender:"",company:"",email:"",phone:"",address:"",about:"",registered:"",latitude:0,longitude:0,tags:[],friends:[],greeting:"",favoriteFruit:""},newTag:"",user:a};angular.extend(e,{model:n,editorOptions:{height:"100px",toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"}],toolbar:"",toolbar_full:""},submit:function(){t.createDocument(e.model.person,{format:"json",directory:"/content/",extension:".json"}).then(function(e){r.location.href="/detail?uri="+e.headers("location").replace(/(.*\?uri=)/,"")})},addTag:function(){n.person.tags.push(n.newTag),n.newTag=""}})}])}(),angular.module("sample.create",[]),function(){"use strict";angular.module("sample.detail").controller("DetailCtrl",["$scope","MLRest","$routeParams",function(e,t,r){var a=r.uri,n={detail:{}};t.getDocument(a,{format:"json",transform:"to-json"}).then(function(e){var t=0,r=null;if(e.data.root){for(n.detail=e.data.root,t=0;t<n.detail._children.length;t++)if(n.detail._children[t].member){r=n.detail._children[t].member;break}}else e.data.member?(n.detail=e.data.member,r=e.data.member):e.data.doc&&(n.detail=e.data.doc);if(r)for(t=0;t<r._children.length;t++)r._children[t].latitude?n.detail.latitude=r._children[t].latitude._children[0]:r._children[t].longitude&&(n.detail.longitude=r._children[t].longitude._children[0])}),angular.extend(e,{model:n})}])}(),angular.module("sample.detail",[]),function(){"use strict";angular.module("sample.esriMap",[]).directive("esriMap",[function(){return{restrict:"E",scope:{detail:"="},template:'<div id="_detailMap" class="map-detail"></div>',controller:"EsriDetailMapController"}}]).controller("EsriDetailMapController",["$scope",function(e){function t(e,t){require(["esri/map","esri/graphic","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/Polygon","esri/graphicsUtils","esri/Color"],function(a,n,l,o,s,u,i,c,m){function d(e){e&&e.latitude&&e.longitude&&(r.mapGeometry=[],r.mapGeometry.push(new u(e.longitude,e.latitude)))}d(t),r.map=new a(e,{basemap:r.baseMap,zoom:6,smartNavigation:!1}),r.graphicsLayer=new s({id:"data"}),r.map.addLayer(r.graphicsLayer),r.map.infoWindow.set("popupWindow",!1),r.map.on("load",function(){r.mapGeometry&&r.drawData(r.mapGeometry)}),r.drawData=function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++){var a=null;if(e[t]instanceof u?a=(new o).setColor(new m([0,0,0,.4])):e[t]instanceof i&&(a=(new l).setColor(new m([0,0,0,.4]))),a){var s=new n(e[t],a);r.graphicsLayer.add(s)}}var d=c.graphicsExtent(r.graphicsLayer.graphics);r.map.setExtent(d,!0)}}})}var r=this;r.baseMap="national-geographic",r.mapGeometry=null,t("_detailMap",e.detail)}])}(),function(){"use strict";angular.module("sample.search").controller("SearchCtrl",["$scope","$location","User","MLSearchFactory","MLRemoteInputService",function(e,t,r,a,n){function l(e){u.search=e,u.qtext=s.getText(),u.page=s.getPage(),n.setInput(u.qtext),t.search(s.getParams())}function o(e){return u.user.authenticated?(arguments.length&&(u.qtext=e),void s.setText(u.qtext).setPage(u.page).search().then(l)):void(u.search={})}var s=a.newContext(),u={page:1,qtext:"",search:{},user:r};!function(){n.initCtrl(e,u,s,o),e.$watch("model.user.authenticated",function(){o()}),s.fromParams().then(function(){s.setText(u.qtext),l({})}),e.$on("$locationChangeSuccess",function(e,t,r){s.locationChange(t,r).then(function(){o()})})}(),angular.extend(e,{model:u,search:o,toggleFacet:function(e,t){s.toggleFacet(e,t).search().then(l)}})}])}(),angular.module("sample.search",[]),function(){"use strict";angular.module("sample.sources",[]).controller("SourcesCtrl",["$scope","counts",function(e,t){var r=this;angular.extend(r,{counts:t})}]).controller("DataStatsChartCtrl",["$scope",function(e){function t(e){return{chart:{type:"column"},title:{text:"Data Sources"},xAxis:{type:"category",labels:{style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"}}},yAxis:{min:1,type:"logarithmic",title:{text:"Count"}},tooltip:{crosshairs:!0,shared:!1,useHTML:!0,headerFormat:'<span class="name">{point.key}</span><br/>',pointFormat:'<b style="margin-top: 2px">{point.y} {point.format}</b><br/><a href="{point.url}" target="_blank">Source</a><br/><p>{point.desc}</p>'},series:[{name:"Data Source",data:e}]}}var r=this;r.title="Data Sources",e.$watch("data",function(r,a){var n,l,o=[];if(r){for(n=0;n<r.length;n++)l=r[n],o.push({name:l.name,y:l.count,desc:l.description,format:l.format,url:l.url});e.chart?e.chart.series[0].setData(o,!0):e.createChart(t(o))}else e.chart&&e.chart.series[0].setData([],!0)})}])}(),function(){"use strict";angular.module("sample.sql",[]).service("SqlService",function(e){this.query2=function(t){var r='<sql:request xmlns:sql="http://xqdev.com/sql"><sql:type>query</sql:type><sql:query>'+t+"</sql:query></sql:request>";return e.post("http://cookshow-ml1:8080/mlsql/",r).success(function(e,t,r,a){console.log("success: "+e)}).error(function(e,t,r,a){console.log("error: "+e)}),t},this.query=function(t){var r={query:t};return e.post("/v1/resources/run-sql",r)}}).controller("SqlCtrl",["$scope","$routeParams","SqlService",function(e,t,r){var a=(t.uri,{results:null,mlsamUrl:"http://localhost:8080/mlsql/",sqlStatement:"show tables;"});angular.extend(e,{model:a,submit:function(){r.query(a.sqlStatement).success(function(t,r,a,n){t.results&&e.processResults(t.results)}).error(function(e,t,r,n){console.log("error: "+e),a.results=e})},processResults:function(e){if(a.results=e,a.headings=[],e&&e.length>0){if(e[0].tuple)for(var t=e[0].tuple,r=0;r<t._children.length;r++){var n=Object.keys(t._children[r]);a.headings.push(n[0])}}else if(e&&e.tuple){for(var t=e.tuple,r=0;r<t._children.length;r++){var n=Object.keys(t._children[r]);a.headings.push(n[0])}a.results=[],a.results.push(e)}},loadTables:function(){a.results=r.query("show tables;").success(function(e,t,r,n){if(a.tables=[],e.results&&e.results.length>0)for(var l=0;l<e.results.length;l++)if(e.results[l].tuple){var o=e.results[l].tuple;if(o._children&&o._children.length>0){var s=Object.keys(o._children[0]);s&&s.length>0&&a.tables.push(o._children[0][s[0]]._children[0])}}}).error(function(e,t,r,n){console.log("error: "+e),a.tables=e})},loadTableData:function(e){a.tableName=e,a.tableCount=0,a.tableDescribeResults=null,a.tableDescribeHdrs=[],a.tableSelectResults=null,a.tableSelectHdrs=[],r.query("select count(*) as count from "+e+";").success(function(e,t,r,n){if(e.results&&e.results.tuple){var l=e.results.tuple;l._children&&l._children.length>0&&(a.tableCount=l._children[0].count._children[0])}}).error(function(e,t,r,a){console.log("Table Count - error: "+e)}),r.query("describe "+e+";").success(function(e,t,r,n){if(e.results&&e.results.length>0&&(a.tableDescribeResults=e.results,e.results[0].tuple))for(var l=e.results[0].tuple,o=0;o<l._children.length;o++){var s=Object.keys(l._children[o]);a.tableDescribeHdrs.push(s[0])}}).error(function(e,t,r,a){console.log("Table Describe - error: "+e)}),r.query("select * from "+e+" limit 10;").success(function(e,t,r,n){if(e.results&&e.results.length>0&&(a.tableSelectResults=e.results,e.results[0].tuple))for(var l=e.results[0].tuple,o=0;o<l._children.length;o++){var s=Object.keys(l._children[o]);a.tableSelectHdrs.push(s[0])}}).error(function(e,t,r,a){console.log("Table Select - error: "+e)})}}),e.loadTables()}])}(),function(){"use strict";angular.module("sample.user").controller("ProfileCtrl",["$scope","MLRest","User","$location",function(e,t,r,a){var n={user:r,newEmail:""};angular.extend(e,{model:n,addEmail:function(){e.profileForm.newEmail.$error.email||(e.model.user.emails||(e.model.user.emails=[]),e.model.user.emails.push(n.newEmail),n.newEmail="")},removeEmail:function(t){e.model.user.emails.splice(t,1)},submit:function(){t.updateDocument({user:{fullname:e.model.user.fullname,emails:e.model.user.emails}},{format:"json",uri:"/users/"+e.model.user.name+".json"}).then(function(e){a.path("/")})}})}])}(),function(){"use strict";angular.module("sample.user").directive("mlUser",[function(){return{restrict:"EA",controller:"UserController",replace:!0,scope:{},templateUrl:"/user/user-dir.html"}}]).controller("UserController",["$scope","User",function(e,t){angular.extend(e,{user:t,login:t.login,logout:function(){t.logout(),e.password=""}})}])}(),function(){"use strict";angular.module("sample.user").factory("User",["$http",function(e){function t(){return a.name="",a.password="",a.loginError=!1,a.authenticated=!1,a.hasProfile=!1,a.fullname="",a.emails=[],a}function r(e){var t=e.data;a.authenticated=t.authenticated,a.authenticated&&(a.name=t.username,t.profile&&(a.hasProfile=!0,a.fullname=t.profile.fullname,_.isArray(t.profile.emails)?a.emails=t.profile.emails:a.emails=[t.profile.emails]))}var a={};return t(),e.get("/user/status",{}).then(r),angular.extend(a,{login:function(t,n){e.get("/user/login",{params:{username:t,password:n}}).then(function(e){r(e),a.loginError=!a.authenticated})},logout:function(){e.get("/user/logout").then(t)}}),a}])}(),angular.module("sample.user",["sample.common"]),function(){"use strict";angular.module("sample.common").factory("MLSampleQueryBuilder",[function(){var e=function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"and-query":{queries:arguments[0]}}:{"and-query":{queries:Array.prototype.slice.call(arguments)}}};return{andQuery:e,boostQuery:function(t,r){return t?{"boost-query":{"matching-query":t,"boosting-query":r}}:{"boost-query":{"matching-query":e(),"boosting-query":r}}},collectionConstraintQuery:function(e,t){return{"collection-constraint-query":{"constraint-name":e,uri:Array.isArray(t)?t:[t]}}},customConstraintQuery:function(e,t){return{"custom-constraint-query":{"constraint-name":e,text:t}}},customGeospatialConstraintQuery:function(e,t,r){return{"custom-constraint-query":{"constraint-name":e,annotation:t,box:r}}},documentQuery:function(e){return{"document-query":{uri:Array.isArray(e)?e:[e]}}},geospatialConstraintQuery:function(e,t){return{"geospatial-constraint-query":{"constraint-name":e,box:t}}},operatorState:function(e,t){return{"operator-state":{"operator-name":e,"state-name":t}}},orQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{"or-query":{queries:arguments[0]}}:{"or-query":{queries:Array.prototype.slice.call(arguments)}}},propertiesQuery:function(e){return{"properties-query":e}},rangeConstraintQuery:function(e,t,r,a){return a||(a=[]),t||(t="EQ"),{"range-constraint-query":{"constraint-name":e,"range-operator":t,value:r,"range-option":a}}},structuredQuery:function(){return 1===arguments.length&&angular.isArray(arguments[0])?{query:{queries:arguments[0]}}:{query:{queries:Array.prototype.slice.call(arguments)}}},termQuery:function(e,t){return t?{"term-query":{text:e,weight:t}}:{"term-query":{text:e}}},textQuery:function(e){return{qtext:e}}}}])}();